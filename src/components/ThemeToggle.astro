<button
  id="theme-toggle"
  class="theme-toggle-animate flex items-center justify-center w-6 h-6 transition-colors duration-200 ease-in-out hover:opacity-80"
  aria-label="Toggle theme"
  type="button"
>
  <span class="sr-only">Toggle theme</span>
  
  <!-- Colored circle -->
  <div
    id="theme-circle"
    class="w-3 h-3 rounded-full transition-all duration-300 ease-in-out"
    style="background-color: #24837B;"
  ></div>
</button>

<script>
  const setListener = () => {
    const button = document.getElementById("theme-toggle");
    const circle = document.getElementById("theme-circle");
    
    if (!circle) return;
    
    // Set initial state
    const html = document.documentElement;
    if (html.classList.contains("dark")) {
      circle.style.backgroundColor = "#F4D03F"; // Bright yellow sun
    } else if (html.classList.contains("flexoki")) {
      // circle.style.backgroundColor = "#205EA6"; // Flexoki blue - commented out
    } else {
      circle.style.backgroundColor = "#34495E"; // Dark blue-gray night
    }
    
    button?.addEventListener("click", () => {
      // Play sound effect
      const audio = new Audio("/static/sound.mp3");
      audio.volume = 0.3;
      audio.play().catch(e => console.log("Audio play failed:", e));
      
      // Toggle themes
      const html = document.documentElement;
      
      if (!html.classList.contains("dark") && !html.classList.contains("flexoki")) {
        // From light to dark (skipping flexoki for now)
        html.classList.add("dark");
        circle.style.backgroundColor = "#F4D03F"; // Bright yellow sun
      } else if (html.classList.contains("flexoki")) {
        // From flexoki to dark
        html.classList.remove("flexoki");
        html.classList.add("dark");
        circle.style.backgroundColor = "#F4D03F"; // Bright yellow sun
      } else if (html.classList.contains("dark")) {
        // From dark back to light
        html.classList.remove("dark");
        circle.style.backgroundColor = "#34495E"; // Dark blue-gray night
      }
    });
  };
  setListener();
  document.addEventListener("astro:after-swap", setListener);
</script>
