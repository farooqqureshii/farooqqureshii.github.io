---
// Theme toggle component
---

<button
  id="theme-toggle"
  class="w-6 h-6 flex items-center justify-center no-theme-transition"
  aria-label="Toggle theme"
  title="Toggle theme"
>
<style>
  /* Set initial state for dark mode */
  html.dark #toggle-line {
    transform: translate(-50%, -50%) rotate(90deg);
  }
  
  /* Ensure smooth transitions only after initial load */
  #toggle-line {
    transition: transform 0.3s ease-in-out;
  }
</style>
  <div class="relative w-4 h-4">
    <div 
      id="toggle-line"
      class="absolute top-1/2 left-1/2 w-3 h-px bg-black dark:bg-white transform -translate-x-1/2 -translate-y-1/2 transition-transform duration-300 ease-in-out no-theme-transition"
      style="will-change: transform;"
    ></div>
  </div>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const toggle = document.getElementById('theme-toggle');
    const line = document.getElementById('toggle-line');
    
    if (!toggle || !line) return;

    toggle.addEventListener('click', function() {
      // Play sound effect
      const audio = new Audio("/static/sound.mp3");
      audio.volume = 0.3;
      audio.play().catch(e => console.log("Audio play failed:", e));
      
      const html = document.documentElement;
      
      // Disable transitions during theme toggle
      html.classList.add('disable-theme-transition');
      
      if (!html.classList.contains("dark") && !html.classList.contains("flexoki")) {
        // From light to dark (skipping flexoki for now)
        html.classList.add("dark");
        line.style.transform = "translate(-50%, -50%) rotate(90deg)";
      } else if (html.classList.contains("flexoki")) {
        // From flexoki to dark
        html.classList.remove("flexoki");
        html.classList.add("dark");
        line.style.transform = "translate(-50%, -50%) rotate(90deg)";
      } else if (html.classList.contains("dark")) {
        // From dark back to light
        html.classList.remove("dark");
        line.style.transform = "translate(-50%, -50%) rotate(0deg)";
      }
      
      // Remove disable class after paint to re-enable transitions
      setTimeout(() => {
        html.classList.remove('disable-theme-transition');
      }, 50);
    });
  });
</script>
