---
// component import
import SpotifyNowPlaying from './SpotifyNowPlaying.astro';
---

<footer class="mt-12 footer-animate">
  <div class="flex flex-col gap-1 text-xs footer-line-color w-full items-start text-left">
    <div class="flex justify-start items-center w-full gap-1.5 flex-wrap">
      <span class="footer-svg-cycler relative inline-flex items-center justify-center w-3 h-3 flex-shrink-0" aria-hidden="true">
        <svg class="footer-cycler-svg absolute top-0 left-0 w-3 h-3 opacity-0 transition-opacity duration-300" data-index="0" xmlns="http://www.w3.org/2000/svg" width="256" height="256" fill="none" viewBox="0 0 256 256"><path d="M 128 0 C 198.692 0 256 57.308 256 128 C 256 198.692 198.692 256 128 256 C 57.308 256 0 198.692 0 128 C 0 57.308 57.308 0 128 0 Z M 128 32 C 74.98 32 32 74.98 32 128 C 32 181.019 74.98 224 128 224 C 181.019 224 224 181.019 224 128 C 224 74.98 181.019 32 128 32 Z M 128 112 C 136.837 112 144 119.163 144 128 C 144 136.837 136.837 144 128 144 C 119.163 144 112 136.837 112 128 C 112 119.163 119.163 112 128 112 Z" fill="rgb(84, 84, 84)"></path></svg>
        <svg class="footer-cycler-svg absolute top-0 left-0 w-3 h-3 opacity-0 transition-opacity duration-300" data-index="1" xmlns="http://www.w3.org/2000/svg" width="256" height="256" fill="none" viewBox="0 0 256 256"><path d="M 32 192 C 32 209.673 46.327 224 64 224 C 64 241.673 49.673 256 32 256 C 14.327 256 0 241.673 0 224 C 0 206.327 14.327 192 32 192 Z M 96 192 C 96 209.673 110.327 224 128 224 C 128 241.673 113.673 256 96 256 C 78.327 256 64 241.673 64 224 C 81.673 224 96 209.673 96 192 Z M 160 192 C 160 209.673 174.327 224 192 224 C 192 241.673 177.673 256 160 256 C 142.327 256 128 241.673 128 224 C 145.673 224 160 209.673 160 192 Z M 224 192 C 241.673 192 256 206.327 256 224 C 256 241.673 241.673 256 224 256 C 206.327 256 192 241.673 192 224 C 209.673 224 224 209.673 224 192 Z M 32 128 C 32 145.673 46.327 160 64 160 C 46.327 160 32 174.327 32 192 C 14.327 192 0 177.673 0 160 C 0 142.327 14.327 128 32 128 Z M 96 128 C 96 145.673 110.327 160 128 160 C 128 177.673 113.673 192 96 192 C 78.327 192 64 177.673 64 160 C 64 142.327 78.327 128 96 128 Z M 160 128 C 177.673 128 192 142.327 192 160 C 192 177.673 177.673 192 160 192 C 142.327 192 128 177.673 128 160 C 145.673 160 160 145.673 160 128 Z M 224 128 C 241.673 128 256 142.327 256 160 C 256 177.673 241.673 192 224 192 C 224 174.327 209.673 160 192 160 C 209.673 160 224 145.673 224 128 Z M 32 64 C 32 81.673 46.327 96 64 96 C 46.327 96 32 110.327 32 128 C 14.327 128 0 113.673 0 96 C 0 78.327 14.327 64 32 64 Z M 96 64 C 113.673 64 128 78.327 128 96 C 110.327 96 96 110.327 96 128 C 78.327 128 64 113.673 64 96 C 64 78.327 78.327 64 96 64 Z M 160 64 C 177.673 64 192 78.327 192 96 C 192 113.673 177.673 128 160 128 C 160 110.327 145.673 96 128 96 C 128 78.327 142.327 64 160 64 Z M 224 64 C 241.673 64 256 78.327 256 96 C 256 113.673 241.673 128 224 128 C 224 110.327 209.673 96 192 96 C 209.673 96 224 81.673 224 64 Z M 32 0 C 49.673 0 64 14.327 64 32 C 46.327 32 32 46.327 32 64 C 14.327 64 0 49.673 0 32 C 0 14.327 14.327 0 32 0 Z M 96 0 C 113.673 0 128 14.327 128 32 C 110.327 32 96 46.327 96 64 C 96 46.327 81.673 32 64 32 C 64 14.327 78.327 0 96 0 Z M 160 0 C 177.673 0 192 14.327 192 32 C 174.327 32 160 46.327 160 64 C 160 46.327 145.673 32 128 32 C 128 14.327 142.327 0 160 0 Z M 224 0 C 241.673 0 256 14.327 256 32 C 256 49.673 241.673 64 224 64 C 224 46.327 209.673 32 192 32 C 192 14.327 206.327 0 224 0 Z" fill="rgb(84, 84, 84)"></path></svg>
        <svg class="footer-cycler-svg absolute top-0 left-0 w-3 h-3 opacity-0 transition-opacity duration-300" data-index="2" xmlns="http://www.w3.org/2000/svg" width="256" height="256" fill="none" viewBox="0 0 256 256"><path d="M 160 0 C 177.397 0 191.551 13.883 191.989 31.174 L 192.011 32.826 C 192.442 49.843 206.157 63.558 223.174 63.989 L 224.826 64.011 C 242.117 64.449 256 78.603 256 96 C 256 113.673 241.673 128 224 128 C 241.673 128 256 142.327 256 160 C 256 177.397 242.117 191.551 224.826 191.989 L 223.174 192.011 C 206.157 192.442 192.442 206.157 192.011 223.174 L 191.989 224.826 C 191.551 242.117 177.397 256 160 256 C 142.327 256 128 241.673 128 224 C 128 241.673 113.673 256 96 256 C 78.603 256 64.449 242.117 64.01 224.826 L 63.99 223.174 C 63.558 206.157 49.843 192.442 32.826 192.011 L 31.174 191.989 C 13.883 191.551 0 177.397 0 160 C 0 142.327 14.327 128 32 128 C 14.327 128 0 113.673 0 96 C 0 78.603 13.883 64.449 31.174 64.01 L 32.826 63.99 C 49.843 63.558 63.558 49.843 63.989 32.826 L 64.011 31.174 C 64.449 13.883 78.603 0 96 0 C 113.673 0 128 14.327 128 32 C 128 14.327 142.327 0 160 0 Z M 128 64 C 128 99.346 99.346 128 64 128 C 99.346 128 128 156.654 128 192 C 128 156.654 156.654 128 192 128 C 156.654 128 128 99.346 128 64 Z" fill="rgb(84, 84, 84)"></path></svg>
        <svg class="footer-cycler-svg absolute top-0 left-0 w-3 h-3 opacity-0 transition-opacity duration-300" data-index="3" xmlns="http://www.w3.org/2000/svg" width="256" height="256" fill="none" viewBox="0 0 256 256"><path d="M 152 70.059 L 201.539 20.519 L 235.48 54.461 L 185.941 104 L 256 104 L 256 152 L 185.941 152 L 235.48 201.539 L 201.539 235.48 L 152 185.941 L 152 256 L 104 256 L 104 185.941 L 54.46 235.48 L 20.52 201.539 L 70.059 152 L 0 152 L 0 104 L 70.059 104 L 20.519 54.46 L 54.461 20.52 L 104 70.059 L 104 0 L 152 0 Z" fill="rgb(84, 84, 84)"></path></svg>
        <svg class="footer-cycler-svg absolute top-0 left-0 w-3 h-3 opacity-0 transition-opacity duration-300" data-index="4" xmlns="http://www.w3.org/2000/svg" width="256" height="256" fill="none" viewBox="0 0 256 256"><path d="M 128 128 C 128 198.692 70.692 256 0 256 C 0 185.308 57.308 128 128 128 Z M 128 128 C 198.692 128 256 185.308 256 256 C 185.308 256 128 198.692 128 128 Z M 0 0 C 70.692 0 128 57.308 128 128 C 57.308 128 0 70.692 0 0 Z M 256 0 C 256 70.692 198.692 128 128 128 C 128 57.308 185.308 0 256 0 Z" fill="rgb(84, 84, 84)"></path></svg>
      </span>
      <span class="flex items-center gap-1.5">
        <span>Ottawa, ON</span>
        <span aria-hidden="true">|</span>
        <span id="ottawa-time" class="opacity-0 transition-opacity duration-300">--:--</span>
      </span>
    </div>
    <div style="margin-top:0.25rem; min-height:4rem;" class="opacity-0 translate-y-2 transition-all duration-500 ease-out w-full flex justify-start" id="quote-container">
      <div id="quote-rotator" style="cursor:pointer; display:inline;">
        <span id="quote-text"></span>
      </div>
    </div>
    <!-- <SpotifyNowPlaying /> -->
  </div>

  <script>
    // Footer SVG cycler - cycle through 5 SVGs every 600ms
    (function runSvgCycler() {
      const cycler = document.querySelector('.footer-svg-cycler');
      if (!cycler) return;
      const svgs = cycler.querySelectorAll('.footer-cycler-svg');
      if (svgs.length === 0) return;
      let idx = 0;
      svgs[0].classList.add('!opacity-100');
      setInterval(() => {
        svgs[idx].classList.remove('!opacity-100');
        idx = (idx + 1) % svgs.length;
        svgs[idx].classList.add('!opacity-100');
      }, 600);
    })();

    // Ottawa time script - defer to not block initial render
    function updateOttawaTime() {
      const ottawaTime = new Date().toLocaleTimeString('en-CA', {
        timeZone: 'America/Toronto',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
      });
      const el = document.getElementById('ottawa-time');
      if (el) {
        el.textContent = ottawaTime;
        el.classList.remove('opacity-0');
      }
    }
    // Defer time update to not block initial render
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        updateOttawaTime();
        setInterval(updateOttawaTime, 1000);
      });
    } else {
      requestAnimationFrame(() => {
        updateOttawaTime();
        setInterval(updateOttawaTime, 1000);
      });
    }

    // Quote rotator script
    const quotes = [
      { text: "The map is not the territory.", author: "Alfred Korzybski" },
      { text: "Not everything that counts can be counted, and not everything that can be counted counts.", author: "William Bruce Cameron" },
      { text: "We're all just walking each other home.", author: "Ram Dass" },
      { text: "And you? When will you begin that long journey into yourself?", author: "Rumi" },
      { text: "One must imagine Sisyphus happy.", author: "Albert Camus" },
      { text: "Don't use seven words when four will do.", author: "Rusty Ryan, Oceans Eleven" },
      { text: "A stitch in time saves nine.", author: "Proverb" },
      { text: "A wealth of information creates a poverty of attention.", author: "Herbert A. Simon" },
      { text: "Simple systems don't always give simple answers.", author: "John Gall" },
      { text: "You can't fix by analysis what you've bungled by design.", author: "Light Hill's Law" },
      { text: "Life moves pretty fast. If you don't stop and look around once in a while, you could miss it.", author: "Ferris Bueller's Day Off" },
      { text: "We don't see things as they are, we see them as we are.", author: "Anaïs Nin" },
      { text: "Nature does not hurry, yet everything is accomplished.", author: "Lao Tzu" },
      { text: "Only entropy comes easy.", author: "Anton Chekhov" },
      { text: "Meaning is not in things but in between.", author: "The Poetics of Space, Gaston Bachelard" },
      { text: "All that is gold does not glitter.", author: "The Fellowship of the Ring, J.R.R. Tolkien" },
      { text: "There's no place like home.", author: "Dorothy Gale, The Wizard of Oz" },
      { text: "Curiouser and curiouser!", author: "Alice, Alice in Wonderland" },
      { text: "Dream Big, Start Small", author: "Unknown" },
      { text: "Oh, but my darling, what if you fly?", author: "Erin Hanson" },
      { text: "Joy is what happens to us when we allow ourselves to recognize how good things really are.", author: "M. Kristin Rawlings" },
      { text: "Why make life difficult when it's so easy to live effortlessly?", author: "David Zinczenko" },
      { text: "A way of thinking that has value isn’t necessarily the way to do it.", author: "Leonardo da Vinci" },
      { text: "Wherever you go, go with all your heart.", author: "Confucius" },
      { text: "I am not the same, having seen the moon, than when I was the moon.", author: "G.K. Chesterton" },
      { text: "Get rid of anything that isn't essential to your truth, and you will see the truth clearly.", author: "David Lynch" },
      { text: "Be excellent to each other.", author: "The Hitchhiker's Guide to the Galaxy" },
      { text: "I am certain of nothing but the holiness of the heart's affections and the truth of the heart's yearnings.", author: "John Keats" },
      { text: "It's a funny thing. Life gets so busy. You've got to play to stay close.", author: "Andrew D. Holder" },
      { text: "First learn the rules, then break them.", author: "Dada" },
      { text: "Sometimes you win, sometimes you learn.", author: "John Maxwell" },
      { text: "Don't judge each day by the harvest you reap but by the seeds you plant.", author: "Robert Louis Stevenson" },
      { text: "The biggest problem in the universe is nobody helps each other.", author: "Shmi Skywalker, The Phantom Menace" },
      { text: "Happiness only real when shared.", author: "Christopher McCandless" },
      { text: "Given much, do much more", author: "Unknown" },
    ];
    let lastIndex = -1;
    let isTyping = false;

    async function typeText(element: HTMLElement, text: string, speed = 20) {
      element.innerHTML = '';
      for (let i = 0; i < text.length; i++) {
        element.innerHTML += text[i];
        await new Promise(resolve => setTimeout(resolve, speed));
      }
    }

    async function showRandomQuote() {
      if (isTyping) return; // Prevent multiple typing animations
      
      let idx;
      do {
        idx = Math.floor(Math.random() * quotes.length);
      } while (idx === lastIndex && quotes.length > 1);
      lastIndex = idx;
      const q = quotes[idx];
      const quoteTextEl = document.getElementById('quote-text');
      const quoteContainer = document.getElementById('quote-container');
      
      if (quoteTextEl && quoteContainer) {
        isTyping = true;
        
        // Slide in the quote container
        quoteContainer.classList.remove('opacity-0', 'translate-y-2');
        
        // Type the quote first
        await typeText(quoteTextEl, `"${q.text}" — `, 15);
        
        // Type the author in italics
        const authorText = q.author;
        for (let i = 0; i < authorText.length; i++) {
          quoteTextEl.innerHTML += authorText[i];
          await new Promise(resolve => setTimeout(resolve, 10));
        }
        // Wrap the author in italics after typing
        const currentText = quoteTextEl.innerHTML;
        const authorStart = currentText.lastIndexOf(q.author);
        if (authorStart !== -1) {
          const beforeAuthor = currentText.substring(0, authorStart);
          const afterAuthor = currentText.substring(authorStart + q.author.length);
          quoteTextEl.innerHTML = beforeAuthor + `<i>${q.author}</i>` + afterAuthor;
        }
        
        // Add the next quote icon
        quoteTextEl.innerHTML += `<svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-left:0.5em; display:inline; vertical-align:middle;"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>`;
        
        isTyping = false;
      }
    }
    const quoteRotator = document.getElementById('quote-rotator');
    if (quoteRotator) {
      quoteRotator.onclick = showRandomQuote;
      // Defer quote animation to not block initial render - load after page is interactive
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          // Use requestIdleCallback for non-critical animation, fallback to setTimeout
          if ('requestIdleCallback' in window) {
            requestIdleCallback(() => showRandomQuote(), { timeout: 500 });
          } else {
            setTimeout(() => showRandomQuote(), 100);
          }
        });
      } else {
        if ('requestIdleCallback' in window) {
          requestIdleCallback(() => showRandomQuote(), { timeout: 500 });
        } else {
          setTimeout(() => showRandomQuote(), 100);
        }
      }
    }
  </script>
</footer>
